<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="/style.css">
</head>
<body>

    <nav class="navbar navbar-expand navbar-dark">
        <div class="container justify-content-center">
            <div class="navbar-nav bg-dark rounded-pill px-4 py-2 shadow-lg">
                <a class="nav-link mx-2 active" onclick="navigate('home')">Register</a>
                <a class="nav-link mx-2" onclick="navigate('about')">About</a>
            </div>
        </div>
    </nav>

    <div class="container mt-5 pt-5">
        <div class="row justify-content-center">
            <div class="col-lg-5 col-md-8 col-sm-10">

                <div id="home" class="route-section active">
                    <div class="card card-custom p-4 p-md-5">
                        <h2 class="text-center">Create Account</h2>
                        
                        <% if (errors) { %>
                            <div class="alert alert-danger rounded-3 border-0 shadow-sm">
                                <ul class="mb-0 ps-3">
                                    <% errors.forEach(e => { %> <li><%= e %></li> <% }) %>
                                </ul>
                            </div>
                        <% } %>

                        <form action="/submit" method="POST" onsubmit="return validateForm()">
                            <div class="mb-3">
                                <label for="username">Username</label>
                                <input type="text" class="form-control" id="username" name="username" placeholder="Choose a username">
                            </div>
                            <div class="mb-3">
                                <label for="email">Email</label>
                                <input type="email" class="form-control" id="email" name="email" placeholder="name@example.com">
                            </div>
                            <div class="mb-3">
                                <label for="age">Age</label>
                                <input type="number" class="form-control" id="age" name="age" placeholder="18">
                            </div>

                            <div class="mb-4">
                                <label for="password">Password</label>
                                <div class="input-group">
                                    <input type="password" class="form-control" id="password" name="password" oninput="checkStrength()" placeholder="••••••••">
                                    
                                    <button class="btn btn-outline-secondary" type="button" id="togglePasswordBtn" onclick="togglePassword()">
                                        <i class="bi bi-eye"></i>
                                    </button>
                                </div>
                                
                                <div id="meter-bar" class="strength-meter"></div>
                                <div class="d-flex justify-content-between mt-1">
                                    <small id="strength-text" class="text-muted">Strength: None</small>
                                </div>
                            </div>

                            <button type="submit" class="btn btn-primary w-100 shadow-sm">Create Account</button>
                        </form>
                    </div>
                </div>

                <div id="about" class="route-section">
                    <div class="card card-custom p-5 text-center">
                        <h3 class="text-primary mb-3">About Task 4</h3>
                        <p class="text-secondary">This form uses <strong>Node.js</strong> for the backend and <strong>Bootstrap 5</strong> for responsive styling.</p>
                        <hr class="my-4 op-1">
                        <p class="small text-muted">The "Glassmorphism" effect is created using backdrop-filter and semi-transparent backgrounds.</p>
                        <button class="btn btn-outline-primary mt-3" onclick="navigate('home')">Back to Register</button>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script>
        // NEW: Toggle Password Function
        function togglePassword() {
            const passwordField = document.getElementById('password');
            const icon = document.querySelector('#togglePasswordBtn i');

            if (passwordField.type === 'password') {
                passwordField.type = 'text'; // Show Password
                icon.classList.remove('bi-eye');
                icon.classList.add('bi-eye-slash'); // Change icon to 'crossed out eye'
            } else {
                passwordField.type = 'password'; // Hide Password
                icon.classList.remove('bi-eye-slash');
                icon.classList.add('bi-eye'); // Change icon back to normal eye
            }
        }

        // ROUTING
        function navigate(sectionId) {
            document.querySelectorAll('.route-section').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-link').forEach(el => el.classList.remove('active'));
            
            document.getElementById(sectionId).classList.add('active');
            
            if(sectionId === 'home') document.querySelector('.nav-link[onclick="navigate(\'home\')"]').classList.add('active');
            if(sectionId === 'about') document.querySelector('.nav-link[onclick="navigate(\'about\')"]').classList.add('active');
        }

        // STRENGTH METER
        function checkStrength() {
            const password = document.getElementById('password').value;
            const meter = document.getElementById('meter-bar');
            const text = document.getElementById('strength-text');

            let strength = 0;
            if (password.length >= 8) strength++;
            if (/[A-Z]/.test(password)) strength++;
            if (/[0-9]/.test(password)) strength++;
            if (/[^A-Za-z0-9]/.test(password)) strength++;

            const width = (strength / 4) * 100;
            meter.style.width = width + "%";

            if (strength <= 1) { meter.style.backgroundColor = "#ff4d4d"; text.innerText = "Weak"; text.style.color = "#ff4d4d"; }
            else if (strength <= 3) { meter.style.backgroundColor = "#ffc107"; text.innerText = "Medium"; text.style.color = "#ffc107"; }
            else { meter.style.backgroundColor = "#28a745"; text.innerText = "Strong"; text.style.color = "#28a745"; }
        }

        // VALIDATION
        function validateForm() {
            const password = document.getElementById('password').value;
            const strictRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/;
            if (!strictRegex.test(password)) {
                alert("Password must contain:\n- 8+ Characters\n- 1 Uppercase Letter\n- 1 Number\n- 1 Symbol");
                return false;
            }
            return true;
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>